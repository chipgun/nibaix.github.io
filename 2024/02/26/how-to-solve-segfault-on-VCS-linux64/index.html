<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta name="description" content="">
  <meta name="author" content="">
  <link rel="icon" href="/img/favicon.png">

  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">

  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5/dist/css/bootstrap.min.css">


  
<link rel="stylesheet" href="/css/style.css">


  
  <title>How to Solve Segfault on VCS Linux64 - 芝士盒</title>
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  <header>
    <nav id="navbar" class="navbar fixed-nav scrolling-navbar">
  <div class="container">
    <div class="mark-wrapper">
      
        <a href="https://blog.nibaix.com/"><img class="logo" src="/img/avatar.png "/> </a>
       
      <div class="title-mark">What's the story?</div>
    </div>
  
    <button id="menu-btn" class="btn menu-btn" type="button" data-bs-toggle="collapse" data-bs-target="#nav-menu">
      <div class="menu-icon"><span></span><span></span><span></span></div>
    </button>
  
    <div id="nav-menu" class="collapse menu-wrapper">
      <ul>
        
          <li>
            <a href="/">Home </a>
          </li>
        
          <li>
            <a href="/archives">Archives </a>
          </li>
        
          <li>
            <a href="/categories">Category </a>
          </li>
        
          <li>
            <a href="/tags">Tag </a>
          </li>
        
          <li>
            <a href="/about">About </a>
          </li>
        
        <li class="search-icon">
          <button class="btn" data-bs-toggle="modal" data-bs-target="#searchModal" aria-label="Search">
            <i class="fas fa-search"></i>
          </button>
        </li>
      </ul>
    </div>
  </div>
</nav>

  </header>

  <main>
    <div class="container">
      <div id="main">
        <div class="row py-5">
          <div class="col">
            <div class="row">
  <div class="left-content">
    <article class="post-wrapper markdown-body">
  <h2 class="post-title">
    How to Solve Segfault on VCS Linux64
  </h2>
  <div class="post-meta">
    <time datetime="Invalid date Invalid date ">2024-02-26</time>
    
    
      
        <a class="tag" href="/categories/VLSI/">VLSI</a> 
       
    
    
      
        <a class="tag" href="/tags/synopsys/">synopsys</a> 
      
        <a class="tag" href="/tags/vcs/">vcs</a> 
      
        <a class="tag" href="/tags/verdi/">verdi</a> 
       
    
    
  </div>
  
  <div id="content">
    <h3 id="Patching-command-set"><a href="#Patching-command-set" class="headerlink" title="Patching command set"></a>Patching command set</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> <span class="variable">$VCS_HOME</span>/linux64/lib</span><br><span class="line">$ <span class="built_in">cp</span> -p libvcsnew.so libvcsnew.so.bak</span><br><span class="line">$ patcher.py libvcsnew.so</span><br><span class="line">$ <span class="built_in">cp</span> -p libucapi.so libucapi.so.bak</span><br><span class="line">$ patcher.py libucapi.so</span><br></pre></td></tr></table></figure>
<h3 id="Preamble"><a href="#Preamble" class="headerlink" title="Preamble"></a>Preamble</h3><p><em><strong>This is education project. It is made to allow studying computer science, computer architectures and debugging binary codes.</strong></em></p>
<span id="more"></span>

<h3 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h3><h4 id="segfault-in-VCS-Q-2020-03-also-applicable-to-2019-2021-2022-and-etc"><a href="#segfault-in-VCS-Q-2020-03-also-applicable-to-2019-2021-2022-and-etc" class="headerlink" title="segfault in VCS Q-2020.03 (also applicable to 2019, 2021, 2022, and etc)"></a>segfault in VCS Q-2020.03 (also applicable to 2019, 2021, 2022, and etc)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">Command line: ./simv</span><br><span class="line"></span><br><span class="line">--- Stack trace follows:</span><br><span class="line"></span><br><span class="line">Dumping VCS Annotated Stack:</span><br><span class="line"><span class="comment">#0  0x00002aaad3587659 in waitpid () from /lib64/libc.so.6</span></span><br><span class="line"><span class="comment">#1  0x00002aaad3504f62 in do_system () from /lib64/libc.so.6</span></span><br><span class="line"><span class="comment">#2  0x00002aaad3505311 in system () from /lib64/libc.so.6</span></span><br><span class="line"><span class="comment">#3  0x00002aaacb5883fb in SNPSle_10ee25eff68cd8461c9146fa1d0b35e87067f3c8015b313e639d2928478c79b3f673f99203bcf8be64600612100082236bffb2007f1e0ef9 () from /eda/synopsys/vcs/Q-2020.03/linux64/lib/liberrorinf.so</span></span><br><span class="line"><span class="comment">#4  0x00002aaacb589ed3 in SNPSle_10ee25eff68cd8461c9146fa1d0b35e87067f3c8015b313efba706aab251478fa49e66610e453774633a6c152e7ef778f2202cda681f3d4e () from /eda/synopsys/vcs/Q-2020.03/linux64/lib/liberrorinf.so</span></span><br><span class="line"><span class="comment">#5  0x00002aaacb582822 in SNPSle_d35ca1ff70d465c2b9b1a72eee90a50630165806651fae96eee2bdb18305df1f () from /eda/synopsys/vcs/Q-2020.03/linux64/lib/liberrorinf.so</span></span><br><span class="line"><span class="comment">#6  0x00002aaacdd162af in SNPSle_64133461705005bb725549e2e6fa1b3f () from /eda/synopsys/vcs/Q-2020.03/linux64/lib/libvcsnew.so</span></span><br><span class="line"><span class="comment">#7  0x00002aaacda6fbef in SNPSle_82244d58c54c18c70d63edc9becab634 () from /eda/synopsys/vcs/Q-2020.03/linux64/lib/libvcsnew.so</span></span><br><span class="line"><span class="comment">#9  0x00002aaacb911904 in mem_free () from /eda/synopsys/vcs/Q-2020.03/linux64/lib/libsnpsmalloc.so</span></span><br><span class="line"><span class="comment">#10 0x00002aaacb8ed015 in snpsCheckFreeFunc () from /eda/synopsys/vcs/Q-2020.03/linux64/lib/libsnpsmalloc.so</span></span><br><span class="line"><span class="comment">#11 0x00002aaacd8428f4 in SNPSle_540905a7b1b27611 () from /eda/synopsys/vcs/Q-2020.03/linux64/lib/libvcsnew.so</span></span><br><span class="line"><span class="comment">#12 0x00002aaacd84323a in SNPSle_9ff9b2dce8f1fde9 () from /eda/synopsys/vcs/Q-2020.03/linux64/lib/libvcsnew.so</span></span><br><span class="line"><span class="comment">#13 0x00002aaacd841308 in SNPSle_36c2d46996c96605 () from /eda/synopsys/vcs/Q-2020.03/linux64/lib/libvcsnew.so</span></span><br><span class="line"><span class="comment">#14 0x00002aaacd8417cd in SNPSle_2c2186f0f2f42415 () from /eda/synopsys/vcs/Q-2020.03/linux64/lib/libvcsnew.so</span></span><br><span class="line"><span class="comment">#15 0x00002aaacd8418e3 in SNPSle_126d17af453e054a () from /eda/synopsys/vcs/Q-2020.03/linux64/lib/libvcsnew.so</span></span><br><span class="line"><span class="comment">#16 0x00002aaad2ca3ea5 in start_thread () from /lib64/libpthread.so.0</span></span><br><span class="line"><span class="comment">#17 0x00002aaad35c0b0d in clone () from /lib64/libc.so.6</span></span><br><span class="line"><span class="comment">#0  0x00002aaad35879fd in nanosleep () from /lib64/libc.so.6</span></span><br><span class="line"><span class="comment">#1  0x00002aaad3587894 in sleep () from /lib64/libc.so.6</span></span><br><span class="line"><span class="comment">#2  0x00002aaacd5e1b76 in SNPSle_95ae9cc2e78cc668673c60b8d88c4908 () from /eda/synopsys/vcs/Q-2020.03/linux64/lib/libvcsnew.so</span></span><br><span class="line"><span class="comment">#3  0x00002aaacd5e1d19 in SNPSle_92de4d0d4cf0d6931bc37e8d42a01d93 () from /eda/synopsys/vcs/Q-2020.03/linux64/lib/libvcsnew.so</span></span><br><span class="line"><span class="comment">#4  0x00002aaacd5e008a in SNPSle_b76ef993ee82b3d58a5cadddbec8b67c () from /eda/synopsys/vcs/Q-2020.03/linux64/lib/libvcsnew.so</span></span><br><span class="line"><span class="comment">#5  0x00002aaacd5e032c in SNPSle_f28f24b8c84ac8f6e02e0b03bcd33aa8 () from /eda/synopsys/vcs/Q-2020.03/linux64/lib/libvcsnew.so</span></span><br><span class="line"><span class="comment">#6  0x00002aaacd5cba31 in SNPSle_5e54eaa1df739f6ed4c1ff24a0986ee6 () from /eda/synopsys/vcs/Q-2020.03/linux64/lib/libvcsnew.so</span></span><br><span class="line"><span class="comment">#7  0x00002aaacd5cbc4c in SNPSle_058778405d2a6c04ddd18247ba7f440f () from /eda/synopsys/vcs/Q-2020.03/linux64/lib/libvcsnew.so</span></span><br><span class="line"><span class="comment">#8  0x00002aaacd5c67d2 in SNPSle_e376be325e61b493d6bd988d8077bacc () from /eda/synopsys/vcs/Q-2020.03/linux64/lib/libvcsnew.so</span></span><br><span class="line"><span class="comment">#9  0x00002aaacd5c6c0f in SNPSle_a10369bdf7c5916ddd6866ce7e2e861c () from /eda/synopsys/vcs/Q-2020.03/linux64/lib/libvcsnew.so</span></span><br><span class="line"><span class="comment">#10 0x00002aaacd5c73e1 in SNPSle_00b1acee80c770570cd75f9efbe24cca () from /eda/synopsys/vcs/Q-2020.03/linux64/lib/libvcsnew.so</span></span><br><span class="line"><span class="comment">#11 0x00002aaacd5c7e6d in SNPSle_ba11b1edbd04051f5bb81b1861cdf84a () from /eda/synopsys/vcs/Q-2020.03/linux64/lib/libvcsnew.so</span></span><br><span class="line"><span class="comment">#12 0x00002aaacd5b6602 in SNPSle_2e65c0794628fc5af60953149776c29b () from /eda/synopsys/vcs/Q-2020.03/linux64/lib/libvcsnew.so</span></span><br><span class="line"><span class="comment">#13 0x00002aaacd5b3262 in SNPSle_541f757be362289a7c9e5618c0ff28327846f8d3cc02839f () from /eda/synopsys/vcs/Q-2020.03/linux64/lib/libvcsnew.so</span></span><br><span class="line"><span class="comment">#14 0x00002aaacd5ad08a in SNPSle_c0de1345d5ab80930e06dd2b68f214c3 () from /eda/synopsys/vcs/Q-2020.03/linux64/lib/libvcsnew.so</span></span><br><span class="line"><span class="comment">#15 0x00002aaacd5ad242 in SNPSle_25cd5712eacded5ff943afa9a81fcb09 () from /eda/synopsys/vcs/Q-2020.03/linux64/lib/libvcsnew.so</span></span><br><span class="line"><span class="comment">#16 0x00002aaacdd34da9 in SNPSle_490598bfebcc8e8183ad3550288b1f82 () from /eda/synopsys/vcs/Q-2020.03/linux64/lib/libvcsnew.so</span></span><br><span class="line"><span class="comment">#17 0x00002aaacdd41962 in SNPSle_490598bfebcc8e81 () from /eda/synopsys/vcs/Q-2020.03/linux64/lib/libvcsnew.so</span></span><br><span class="line"><span class="comment">#18 0x00000000004171ff in main ()</span></span><br><span class="line"></span><br><span class="line">Process VmPeak: 916968 kb, VmSize: 851436 kb</span><br><span class="line">System Free Memory: 119334916 kb, System Free Swap: 4194300 kb</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h3><h4 id="At-first-use-GDB"><a href="#At-first-use-GDB" class="headerlink" title="At first use GDB"></a>At first use GDB</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ gdb ./simv</span><br><span class="line">GNU gdb (GDB) Red Hat Enterprise Linux 7.6.1-120.el7</span><br><span class="line">Copyright (C) 2013 Free Software Foundation, Inc.</span><br><span class="line">License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;</span><br><span class="line">This is free software: you are free to change and redistribute it.</span><br><span class="line">There is NO WARRANTY, to the extent permitted by law.  Type <span class="string">&quot;show copying&quot;</span></span><br><span class="line">and <span class="string">&quot;show warranty&quot;</span> <span class="keyword">for</span> details.</span><br><span class="line">This GDB was configured as <span class="string">&quot;x86_64-redhat-linux-gnu&quot;</span>.</span><br><span class="line">For bug reporting instructions, please see:</span><br><span class="line">&lt;http://www.gnu.org/software/gdb/bugs/&gt;...</span><br><span class="line">Reading symbols from /test/run/simv...(no debugging symbols found)...<span class="keyword">done</span>.</span><br><span class="line">(gdb)</span><br></pre></td></tr></table></figure>
<p>Running of Debugging:  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">(gdb) run</span><br><span class="line">Starting program: /test/run/./simv </span><br><span class="line">[Thread debugging using libthread_db enabled]</span><br><span class="line">Using host libthread_db library <span class="string">&quot;/lib64/libthread_db.so.1&quot;</span>.</span><br><span class="line">process 8968 is executing new program: /test/run/simv</span><br><span class="line">Missing separate debuginfos, use: debuginfo-install glibc-2.17-325.el7_9.x86_64 libgcc-4.8.5-44.el7.x86_64 libstdc++-4.8.5-44.el7.x86_64 libxml2-2.9.1-6.el7.5.x86_64 numactl-libs-2.0.12-5.el7.x86_64 xz-libs-5.2.2-1.el7.x86_64 zlib-1.2.7-19.el7_9.x86_64</span><br><span class="line">[Thread debugging using libthread_db enabled]</span><br><span class="line">Using host libthread_db library <span class="string">&quot;/lib64/libthread_db.so.1&quot;</span>.</span><br><span class="line">Notice: timing checks disabled with +notimingcheck at compile-time</span><br><span class="line">[New Thread 0x2aaada311700 (LWP 9007)]</span><br><span class="line">[Thread 0x2aaada311700 (LWP 9007) exited]</span><br><span class="line">[New Thread 0x2aaada311700 (LWP 9014)]</span><br><span class="line"></span><br><span class="line">Program received signal SIGSEGV, Segmentation fault.</span><br><span class="line">[Switching to Thread 0x2aaada311700 (LWP 9014)]</span><br><span class="line">0x00002aaacb911904 <span class="keyword">in</span> mem_free () from /eda/synopsys/vcs/Q-2020.03/linux64/lib/libsnpsmalloc.so</span><br><span class="line">Missing separate debuginfos, use: debuginfo-install bzip2-libs-1.0.6-13.el7.x86_64 dbus-glib-0.100-7.el7.x86_64 dbus-libs-1.10.24-15.el7.x86_64 elfutils-libelf-0.176-5.el7.x86_64 elfutils-libs-0.176-5.el7.x86_64 glib2-2.56.1-8.el7.x86_64 glibc-2.17-325.el7_9.x86_64 libattr-2.4.46-13.el7.x86_64 libblkid-2.23.2-65.el7_9.1.x86_64 libcap-2.22-11.el7.x86_64 libffi-3.0.13-19.el7.x86_64 libgcc-4.8.5-44.el7.x86_64 libgcrypt-1.5.3-14.el7.x86_64 libgpg-error-1.12-3.el7.x86_64 libmount-2.23.2-65.el7_9.1.x86_64 libselinux-2.5-15.el7.x86_64 libstdc++-4.8.5-44.el7.x86_64 libuuid-2.23.2-65.el7_9.1.x86_64 libxml2-2.9.1-6.el7.5.x86_64 lz4-1.8.3-1.el7.x86_64 numactl-libs-2.0.12-5.el7.x86_64 pcre-8.32-17.el7.x86_64 systemd-libs-219-78.el7_9.3.x86_64 xz-libs-5.2.2-1.el7.x86_64 zlib-1.2.7-19.el7_9.x86_64</span><br><span class="line">(gdb)</span><br></pre></td></tr></table></figure>
<p>So we get segfault which should be fixed. To do it we need to get backtrace:  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">(gdb) backtrace </span><br><span class="line"><span class="comment">#0  0x00002aaacb911904 in mem_free () from /eda/synopsys/vcs/Q-2020.03/linux64/lib/libsnpsmalloc.so</span></span><br><span class="line"><span class="comment">#1  0x00002aaacb8ed015 in snpsCheckFreeFunc () from /eda/synopsys/vcs/Q-2020.03/linux64/lib/libsnpsmalloc.so</span></span><br><span class="line"><span class="comment">#2  0x00002aaacd8428f4 in SNPSle_540905a7b1b27611 () from /eda/synopsys/vcs/Q-2020.03/linux64/lib/libvcsnew.so</span></span><br><span class="line"><span class="comment">#3  0x00002aaacd84323a in SNPSle_9ff9b2dce8f1fde9 () from /eda/synopsys/vcs/Q-2020.03/linux64/lib/libvcsnew.so</span></span><br><span class="line"><span class="comment">#4  0x00002aaacd841308 in SNPSle_36c2d46996c96605 () from /eda/synopsys/vcs/Q-2020.03/linux64/lib/libvcsnew.so</span></span><br><span class="line"><span class="comment">#5  0x00002aaacd8417cd in SNPSle_2c2186f0f2f42415 () from /eda/synopsys/vcs/Q-2020.03/linux64/lib/libvcsnew.so</span></span><br><span class="line"><span class="comment">#6  0x00002aaacd8418e3 in SNPSle_126d17af453e054a () from /eda/synopsys/vcs/Q-2020.03/linux64/lib/libvcsnew.so</span></span><br><span class="line"><span class="comment">#7  0x00002aaad2ca3ea5 in start_thread () from /lib64/libpthread.so.0</span></span><br><span class="line"><span class="comment">#8  0x00002aaad35c0b0d in clone () from /lib64/libc.so.6</span></span><br><span class="line">(gdb)</span><br></pre></td></tr></table></figure>
<p>Attention on GDB frame 6  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">(gdb) frame 6</span><br><span class="line"><span class="comment">#6  0x00002aaacd8418e3 in SNPSle_126d17af453e054a () from /eda/synopsys/vcs/Q-2020.03/linux64/lib/libvcsnew.so</span></span><br><span class="line">(gdb) disas</span><br><span class="line">Dump of assembler code <span class="keyword">for</span> <span class="keyword">function</span> SNPSle_126d17af453e054a:</span><br><span class="line">   0x00002aaacd8418c0 &lt;+0&gt;:	push   %rbx</span><br><span class="line">   0x00002aaacd8418c1 &lt;+1&gt;:	mov    %rdi,%rbx</span><br><span class="line">   0x00002aaacd8418c4 &lt;+4&gt;:	xor    %edi,%edi</span><br><span class="line">   0x00002aaacd8418c6 &lt;+6&gt;:	<span class="built_in">test</span>   %rbx,%rbx</span><br><span class="line">   0x00002aaacd8418c9 &lt;+9&gt;:	je     0x2aaacd8418de &lt;SNPSle_126d17af453e054a+30&gt;</span><br><span class="line">   0x00002aaacd8418cb &lt;+11&gt;:	mov    (%rbx),%eax</span><br><span class="line">   0x00002aaacd8418cd &lt;+13&gt;:	<span class="built_in">test</span>   %eax,%eax</span><br><span class="line">   0x00002aaacd8418cf &lt;+15&gt;:	je     0x2aaacd841930 &lt;SNPSle_126d17af453e054a+112&gt;</span><br><span class="line">   0x00002aaacd8418d1 &lt;+17&gt;:	imul   <span class="variable">$0xf4240</span>,%eax,%edi</span><br><span class="line">   0x00002aaacd8418d7 &lt;+23&gt;:	callq  0x2aaacce069c0 &lt;usleep@plt&gt;</span><br><span class="line">   0x00002aaacd8418dc &lt;+28&gt;:	jmp    0x2aaacd841930 &lt;SNPSle_126d17af453e054a+112&gt;</span><br><span class="line">   0x00002aaacd8418de &lt;+30&gt;:	callq  0x2aaacd8416d6 &lt;SNPSle_2c2186f0f2f42415&gt;</span><br><span class="line">=&gt; 0x00002aaacd8418e3 &lt;+35&gt;:	dec    %eax</span><br><span class="line">   0x00002aaacd8418e5 &lt;+37&gt;:	lea    0x3b55614(%rip),%rax        <span class="comment"># 0x2aaad1396f00</span></span><br><span class="line">   0x00002aaacd8418ec &lt;+44&gt;:	jne    0x2aaacd8418fa &lt;SNPSle_126d17af453e054a+58&gt;</span><br><span class="line">   0x00002aaacd8418ee &lt;+46&gt;:	movl   <span class="variable">$0x2</span>,0x88(%rax)</span><br></pre></td></tr></table></figure>
<p>As you can see <strong>SNPSle_2c2186f0f2f42415</strong> doesn’t have return data. So I suppose we can ignore calling of this function.</p>
<h4 id="Let’s-get-objdump"><a href="#Let’s-get-objdump" class="headerlink" title="Let’s get objdump"></a>Let’s get objdump</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ objdump -D /eda/synopsys/vcs/Q-2020.03/linux64/lib/libvcsnew.so &amp;&gt; dump</span><br></pre></td></tr></table></figure>
<p>VIM allows to open big dump file. After opening find - <strong>SNPSle_126d17af453e054a</strong>  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">0000000001aaf8c0 &lt;SNPSle_126d17af453e054a&gt;:</span><br><span class="line"> 1aaf8c0:   53                      push   %rbx</span><br><span class="line"> 1aaf8c1:   48 89 fb                mov    %rdi,%rbx</span><br><span class="line"> 1aaf8c4:   31 ff                   xor    %edi,%edi</span><br><span class="line"> 1aaf8c6:   48 85 db                <span class="built_in">test</span>   %rbx,%rbx</span><br><span class="line"> 1aaf8c9:   74 13                   je     1aaf8de &lt;SNPSle_126d17af453e054a+0x1e&gt;</span><br><span class="line"> 1aaf8cb:   8b 03                   mov    (%rbx),%eax</span><br><span class="line"> 1aaf8cd:   85 c0                   <span class="built_in">test</span>   %eax,%eax</span><br><span class="line"> 1aaf8cf:   74 5f                   je     1aaf930 &lt;SNPSle_126d17af453e054a+0x70&gt;</span><br><span class="line"> 1aaf8d1:   69 f8 40 42 0f 00       imul   <span class="variable">$0xf4240</span>,%eax,%edi</span><br><span class="line"> 1aaf8d7:   e8 e4 50 5c ff          callq  10749c0 &lt;usleep@plt&gt;</span><br><span class="line"> 1aaf8dc:   eb 52                   jmp    1aaf930 &lt;SNPSle_126d17af453e054a+0x70&gt;</span><br><span class="line"> 1aaf8de:   e8 f3 fd ff ff          callq  1aaf6d6 &lt;SNPSle_2c2186f0f2f42415&gt;</span><br><span class="line"> 1aaf8e3:   ff c8                   dec    %eax</span><br><span class="line"> 1aaf8e5:   48 8d 05 14 56 b5 03    lea    0x3b55614(%rip),%rax        <span class="comment"># 5604f00 &lt;.got+0x15808&gt;</span></span><br></pre></td></tr></table></figure>
<p>We are interested in line - 1aaf8de:   <strong>e8 f3 fd ff ff</strong>          callq  1aaf6d6 <SNPSle_2c2186f0f2f42415><br>It’s callq instruction which we can replace by some nop instructions.<br>Nop instruction is <strong>0x90</strong> in hex code.</p>
<p><strong>First of all you must make backup of VCS tool!</strong></p>
<h4 id="Edit-binary-file-via-hexedit"><a href="#Edit-binary-file-via-hexedit" class="headerlink" title="Edit binary file via hexedit"></a>Edit binary file via hexedit</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexedit /eda/synopsys/vcs/Q-2020.03/linux64/lib/libvcsnew.so</span><br></pre></td></tr></table></figure>
<p>Find <strong>e8 f3 fd ff ff</strong> which is at <strong>1aaf8de</strong> address. And replace this bytes by 0x90! Save changes and close library.<br>So let’s check result via objdump:  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ objdump -D /eda/synopsys/vcs/Q-2020.03/linux64/lib/libvcsnew.so &amp;&gt; new_dump</span><br></pre></td></tr></table></figure>
<p>go to <strong>1aaf8de</strong>  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">0000000001aaf8c0 &lt;SNPSle_126d17af453e054a&gt;:</span><br><span class="line"> 1aaf8c0:   53                      push   %rbx</span><br><span class="line"> 1aaf8c1:   48 89 fb                mov    %rdi,%rbx</span><br><span class="line"> 1aaf8c4:   31 ff                   xor    %edi,%edi</span><br><span class="line"> 1aaf8c6:   48 85 db                <span class="built_in">test</span>   %rbx,%rbx</span><br><span class="line"> 1aaf8c9:   74 13                   je     1aaf8de &lt;SNPSle_126d17af453e054a+0x1e&gt;</span><br><span class="line"> 1aaf8cb:   8b 03                   mov    (%rbx),%eax</span><br><span class="line"> 1aaf8cd:   85 c0                   <span class="built_in">test</span>   %eax,%eax</span><br><span class="line"> 1aaf8cf:   74 5f                   je     1aaf930 &lt;SNPSle_126d17af453e054a+0x70&gt;</span><br><span class="line"> 1aaf8d1:   69 f8 40 42 0f 00       imul   <span class="variable">$0xf4240</span>,%eax,%edi</span><br><span class="line"> 1aaf8d7:   e8 e4 50 5c ff          callq  10749c0 &lt;usleep@plt&gt;</span><br><span class="line"> 1aaf8dc:   eb 52                   jmp    1aaf930 &lt;SNPSle_126d17af453e054a+0x70&gt;</span><br><span class="line"> 1aaf8de:   90                      nop</span><br><span class="line"> 1aaf8df:   90                      nop</span><br><span class="line"> 1aaf8e0:   90                      nop</span><br><span class="line"> 1aaf8e1:   90                      nop</span><br><span class="line"> 1aaf8e2:   90                      nop</span><br><span class="line"> 1aaf8e3:   ff c8                   dec    %eax</span><br><span class="line"> 1aaf8e5:   48 8d 05 14 56 b5 03    lea    0x3b55614(%rip),%rax        <span class="comment"># 5604f00 &lt;.got+0x15808&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="Test"><a href="#Test" class="headerlink" title="Test"></a>Test</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ ./simv</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="variable">$finish</span> called from file <span class="string">&quot;/eda/synopsys/vcs/Q-2020.03//etc/uvm-1.2/base/uvm_root.svh&quot;</span>, line 613.</span><br><span class="line"><span class="variable">$finish</span> at simulation time 0.000ns</span><br><span class="line">           V C S   S i m u l a t i o n   R e p o r t </span><br><span class="line">Time: 0 ps</span><br><span class="line">CPU Time:      2.420 seconds;       Data structure size:  11.7Mb</span><br><span class="line">Sun Mar 20 09:31:25 2022</span><br></pre></td></tr></table></figure>
<p>As you see we done it! We aren’t facing segmentation fault!</p>
<h3 id="Automatization"><a href="#Automatization" class="headerlink" title="Automatization"></a>Automatization</h3><p>To patch library without manually operation there is <a target="_blank" rel="noopener" href="https://github.com/mperov/fixSegfaultVCS/blob/main/patcher.py">patcher.py</a><br>Attention, before running <strong>patcher.py</strong> make backup of library which you would like to patch.</p>
<p>The patcher.py is applicable to the VCS vS-2019 and higher version. Besides <code>libvcsnew.so</code>, another libfile needs to be patched is <code>libucapi.so</code> which is called by VCS urg. </p>
<p>The patcher.py is also applicable to the Verdi vS2019 and higher versions. The Verdi libfile <code>libucapi.so</code> needs to be patched otherwise the software crashes when viewing coverage by <code>verdi -cov</code>.</p>
<p>The complete patching command set is as following.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> <span class="variable">$VCS_HOME</span>/linux64/lib</span><br><span class="line">$ <span class="built_in">cp</span> -p libvcsnew.so libvcsnew.so.bak</span><br><span class="line">$ patcher.py libvcsnew.so</span><br><span class="line">$ <span class="built_in">cp</span> -p libucapi.so libucapi.so.bak</span><br><span class="line">$ patcher.py libucapi.so</span><br><span class="line">$ <span class="built_in">cd</span> <span class="variable">$VERDI_HOME</span>/platform/linux64/bin</span><br><span class="line">$ <span class="built_in">cp</span> -p libucapi.so libucapi.so.bak</span><br><span class="line">$ patcher.py libucapi.so</span><br></pre></td></tr></table></figure>

  </div>

</article>
  </div>
  <div class="right-content">
    <div id="toc" class="toc-wrapper"></div>
  <div>
</div>


          </div>
        </div>
      </div>
    </div>

     
  <button id="scroll-to-top" class="btn btn-top" aria-label="Scroll To Top">
    <i class="fas fa-arrow-up"></i>
  </button>
 

  </main>

  <div class="footer-wrapper">
  <div class="left-content"></div>
  <div class="right-content">
    <div>Copyright &copy;2025</div>
    <div>Powered By <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> - Theme <a target="_blank" rel="noopener" href="https://github.com/thomasyu929/hexo-theme-peomas">Peomas</a></div>
  </div>
</div>

  <div id="searchModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Search</h5>
        <button type="button" class="btn btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="input-wrapper">
          <i class="fas fa-search"></i>
          <input id="search" class="search-input" type="text" placeholder="Input content to search..." />
        </div>
        <ul id="result" class="list-group result-wrapper">
        </ul>
      </div>
    </div>
  </div>
</div>

  
<script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5/dist/js/bootstrap.min.js"></script>


<script src="/js/prism.js"></script>



  
<script src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script>

  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css">

  
<script src="/js/nprogress.js"></script>



 
  
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.11.1/tocbot.min.js"></script>

  
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.11.1/tocbot.css">

 


<script src="/js/event.js"></script>


<script src="/js/search.js"></script>


<script src="/js/plugin.js"></script>



</body>

</html>